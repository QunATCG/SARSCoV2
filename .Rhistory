library(venneuler)
# env setting
{
# set working env
rm(list = ls())
# set your working path
setwd("/Users/liqun/Desktop/Projects/Covid19/Data/Code/SARSCoV2/")
# check your working path
dirNow <- getwd()
}
# libraries
{
library(pheatmap)
library(cowplot)
library(org.Hs.eg.db)
library(reshape2)
library(clusterProfiler)
library(ggplot2)
library(gplots)
library(ggrepel)
library(ggsci)
library(ggpubr)
source("./Code/basicFunction.R")
}
# load data
{
# Ensembl-gene pair
Ensembl_gene <- read.table("./Data/SourceData/matchedID.txt", header = T, sep = "\t")
# Expression
# exp this study
{
exp_total <- read.table("./Data/ExpRNAseq/exp_Data_merge.txt", header = T, sep = "\t")
exp_fpkm <- exp_total[,c(1,11:20)]
exp_fpkm_scale <- t(scale(t(exp_fpkm[,c(3:11)])))
exp_fpkm <- cbind(exp_fpkm[,c(1,2)], exp_fpkm_scale)
exp_fpkm$Mock_mean_scale <- apply(exp_fpkm[,3:5], 1, mean)
exp_fpkm$NT_mean_scale <- apply(exp_fpkm[,6:8], 1, mean)
exp_fpkm$T_mean_scale <- apply(exp_fpkm[,9:11], 1, mean)
}
# DEG table
{
deg_mock_nt_total <- read.table("./Results/Table/DEG/DE_Data_Mock_NT.txt", header = T, sep = "\t")
deg_mock_t_total <- read.table("./Results/Table/DEG/DE_Data_Mock_T.txt", header = T, sep = "\t")
deg_nt_t_total <- read.table("./Results/Table/DEG/DE_Data_NT_T.txt", header = T, sep = "\t")
}
# load public exp
{
exp_GSE150316 <- read.table("./Results/Table/PublicExp/exp_GSE150316_scale.txt", header = T, sep = "\t")
exp_GSE152418 <- read.table("./Results/Table/PublicExp/exp_GSE152418_scale.txt", header = T, sep = "\t")
exp_GSE157103 <- read.table("./Results/Table/PublicExp/exp_GSE157103_scale.txt", header = T, sep = "\t")
}
# merge DEG tables
# deg_mock_nt <- deg_mock_nt_total[,c(1:9,19)]
# common_colnames <- colnames(deg_mock_nt)[2:10]
# colnames(deg_mock_nt) <- c("Ensembl", paste(common_colnames, "MockNT", sep = "_"))
# deg_mock_t <- deg_mock_t_total[,c(1:9,19)]
# colnames(deg_mock_t) <- c("Ensembl",  paste(common_colnames, "MockT", sep = "_"))
# deg_mock_nt_t <- merge(deg_mock_nt, deg_mock_t, by = "Ensembl")
# deg_nt_t <- deg_nt_t_total[,c(1:9,19)]
# colnames(deg_nt_t) <- c("Ensembl",  paste(common_colnames, "NTT", sep = "_"))
# deg_mock_nt_t_total <- merge(deg_mock_nt_t, deg_nt_t, by = "Ensembl")
# ggplot(data = deg_mock_nt_t_total, mapping = aes(x = log2FoldChange_MockNT, y = log2FoldChange_MockT, color = sig_NTT)) +
#   geom_point() +
#   scale_color_manual(values = c(down = "black", none = "grey", up = "blue")) +
#   scale_x_continuous(limits = c(-8, 8)) +
#   scale_y_continuous(limits = c(-8, 8)) +
#   #geom_hline(aes(yintercept = 0), linetype = "dashed") +
#   geom_hline(aes(yintercept = log(1.5)), linetype = "dashed") +
#   geom_hline(aes(yintercept = -log(1.5)), linetype = "dashed") +
#   #geom_vline(aes(xintercept = 0), linetype = "dashed") +
#   geom_vline(aes(xintercept = log(1.5)), linetype = "dashed") +
#   geom_vline(aes(xintercept = -log(1.5)), linetype = "dashed") +
#   geom_text_repel(data = deg_mock_nt_t_total[deg_mock_nt_t_total$Gene_MockNT %in% genes_show_2,], aes(label = Gene_NTT), color = "red") +
#   theme_classic()
# reverse table
reverse_mock_nt_up <- read.table("./Results/Table/DEG/DE_Data_Mock_NT_up_scale.txt", header = T, sep = "\t")
reverse_mock_nt_up <- reverse_mock_nt_up[reverse_mock_nt_up$Check_Mock_NT_up == 1 & reverse_mock_nt_up$Checkreverse == 1, ]
reverse_mock_nt_down <- read.table("./Results/Table/DEG/DE_Data_Mock_NT_down_scale.txt", header = T, sep = "\t")
reverse_mock_nt_down <- reverse_mock_nt_down[reverse_mock_nt_down$Check_Mock_NT_down == 1 & reverse_mock_nt_down$Checkreverse == 1, ]
pheatmap(reverse_mock_nt_up[,1:3], show_rownames = FALSE)
pheatmap(reverse_mock_nt_down[,1:3], show_rownames = FALSE)
representative_genes_mock_nt_up <- rownames(reverse_mock_nt_up[reverse_mock_nt_up$Check_Mock_T_up == 0,])
representative_genes_mock_nt_down <- rownames(reverse_mock_nt_down[reverse_mock_nt_down$Check_Mock_T_down == 0,])
representative_genes_mock_nt_up_exp <- exp_fpkm[exp_fpkm$Ensembl %in% representative_genes_mock_nt_up,]
representative_genes_mock_nt_down_exp <- exp_fpkm[exp_fpkm$Ensembl %in% representative_genes_mock_nt_down,]
representative_genes_mock_nt_up_exp_plot <- representative_genes_mock_nt_up_exp[,c("Mock_1_fpkm", "Mock_2_fpkm", "Mock_3_fpkm", "NT_1_fpkm",
"NT_2_fpkm", "NT_3_fpkm", "T_1_fpkm", "T_2_fpkm", "T_3_fpkm")]
rownames(representative_genes_mock_nt_up_exp_plot) <- representative_genes_mock_nt_up_exp$Gene
pheatmap(representative_genes_mock_nt_up_exp_plot, cluster_cols = F, color = colorRampPalette(colors = c("#fff5f0","#fb6a4a","#67000d"))(100),
cellwidth = 4, cellheight = 4)
representative_genes_mock_nt_down_exp_plot <- representative_genes_mock_nt_down_exp[,c("Mock_1_fpkm", "Mock_2_fpkm", "Mock_3_fpkm", "NT_1_fpkm",
"NT_2_fpkm", "NT_3_fpkm", "T_1_fpkm", "T_2_fpkm", "T_3_fpkm")]
rownames(representative_genes_mock_nt_down_exp_plot) <- representative_genes_mock_nt_down_exp$Gene
pheatmap(representative_genes_mock_nt_down_exp_plot, cluster_cols = F, color = colorRampPalette(colors = c("#f7fcf5","#74c476","#00441b"))(100),
cellwidth = 4, cellheight = 1)
# representative_genes_mock_nt_up_go <- enrichGO(gene = representative_genes_mock_nt_up,
#                                                OrgDb = org.Hs.eg.db,
#                                                keyType = 'ENSEMBL',
#                                                ont = "BP",
#                                                pAdjustMethod = "BH",
#                                                pvalueCutoff = 0.05,
#                                                qvalueCutoff = 0.1,
#                                                readable = TRUE)
# summary(representative_genes_mock_nt_up_go)
#
# representative_genes_mock_nt_down_go <- enrichGO(gene = representative_genes_mock_nt_down,
#                                                OrgDb = org.Hs.eg.db,
#                                                keyType = 'ENSEMBL',
#                                                ont = "BP",
#                                                pAdjustMethod = "BH",
#                                                pvalueCutoff = 0.05,
#                                                qvalueCutoff = 0.1,
#                                                readable = TRUE)
#
# summary(representative_genes_mock_nt_down_go)
}
View(exp_fpkm)
targetGene <- "IL6"
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
p_2 <- qunplotboxgenes(targetGene, exp_GSE150316, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_2
p_3 <- qunplotboxgenes(targetGene, exp_GSE152418, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_3
p_4 <- qunplotboxgenes(targetGene, exp_GSE157103, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_4
targetGene <- "VWF"
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
p_2 <- qunplotboxgenes(targetGene, exp_GSE150316, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_2
p_3 <- qunplotboxgenes(targetGene, exp_GSE152418, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_3
p_4 <- qunplotboxgenes(targetGene, exp_GSE157103, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_4
targetGene <- "IRF1"
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
p_2 <- qunplotboxgenes(targetGene, exp_GSE150316, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_2
p_3 <- qunplotboxgenes(targetGene, exp_GSE152418, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_3
p_4 <- qunplotboxgenes(targetGene, exp_GSE157103, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_4
targetGene <- "IFI44L"
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
p_2 <- qunplotboxgenes(targetGene, exp_GSE150316, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_2
p_3 <- qunplotboxgenes(targetGene, exp_GSE152418, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_3
p_4 <- qunplotboxgenes(targetGene, exp_GSE157103, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_4
p_1
targetGene <- "IFIT3"
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
p_2 <- qunplotboxgenes(targetGene, exp_GSE150316, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_2
p_3 <- qunplotboxgenes(targetGene, exp_GSE152418, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_3
p_4 <- qunplotboxgenes(targetGene, exp_GSE157103, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_4
targetGene <- "OAS3"
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
p_2 <- qunplotboxgenes(targetGene, exp_GSE150316, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_2
p_3 <- qunplotboxgenes(targetGene, exp_GSE152418, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_3
p_4 <- qunplotboxgenes(targetGene, exp_GSE157103, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_4
targetGene <- "ADAR"
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
p_2 <- qunplotboxgenes(targetGene, exp_GSE150316, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_2
p_3 <- qunplotboxgenes(targetGene, exp_GSE152418, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_3
p_4 <- qunplotboxgenes(targetGene, exp_GSE157103, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_4
targetGene <- "TMPRSS2"
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
p_2 <- qunplotboxgenes(targetGene, exp_GSE150316, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_2
p_3 <- qunplotboxgenes(targetGene, exp_GSE152418, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_3
p_4 <- qunplotboxgenes(targetGene, exp_GSE157103, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_4
p_2 <- qunplotboxgenes(targetGene, exp_GSE150316, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_2
p_3 <- qunplotboxgenes(targetGene, exp_GSE152418, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_3
p_4 <- qunplotboxgenes(targetGene, exp_GSE157103, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_4
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
targetGene <- "ACE2"
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
p_2 <- qunplotboxgenes(targetGene, exp_GSE150316, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_2
p_3 <- qunplotboxgenes(targetGene, exp_GSE152418, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_3
p_4 <- qunplotboxgenes(targetGene, exp_GSE157103, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_4
targetGene <- "ACE2"
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
targetGene <- "CTSL"
p_1 <- qunplotboxgenes(targetGene, exp_fpkm, myComparision = list(c("Mock", "NT"),c("Mock","T"), c("NT", "T")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "T")
p_1
p_2 <- qunplotboxgenes(targetGene, exp_GSE150316, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_2
p_3 <- qunplotboxgenes(targetGene, exp_GSE152418, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_3
p_4 <- qunplotboxgenes(targetGene, exp_GSE157103, myComparision = list(c("NC", "Case")),myColors = c("grey", "Dark Red", "Brown"), isThisStudy = "F")
p_4
